<?php
header('Access-Control-Allow-Origin: https://ayomawdb.github.io');
// Load the cache process
include("cache.php");

// This file is generated by Composer
require_once __DIR__ . '/vendor/autoload.php';

$client = new \Github\Client();
$client->authenticate('SECRET', '', Github\Client::AUTH_HTTP_TOKEN);
$fileInfo = $client->api('repo')->contents()->show('ayomawdb', 'pentest-docker', 'modules', 'master');

$jsonData = array();
foreach ($fileInfo as $moduleType) {
  $moduleTypeName = $moduleType["name"];
  $fileInfo = $client->api('repo')->contents()->show('ayomawdb', 'pentest-docker', $moduleType["path"], 'master');
  $moduleNames = array();
  foreach ($fileInfo as $module) {
      $moduleName = $module["name"];
      array_push($moduleNames, $moduleName);
  }
  $jsonData[$moduleTypeName] = $moduleNames;
}

print_r(json_encode($jsonData));

// Save the cache
include("cache_footer.php");
